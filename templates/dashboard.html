<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Finansal Veri Analiz</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .navbar {
            background: rgba(255, 255, 255, 0.1) !important;
            backdrop-filter: blur(10px);
        }
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: none;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 1.5rem;
        }
        .stats-card {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            margin-bottom: 1.5rem;
        }
        .stats-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            border-radius: 25px;
            padding: 10px 25px;
            font-weight: 600;
        }
        .chart-container {
            position: relative;
            height: 400px;
            margin: 1rem 0;
        }
        .footer {
            background: rgba(0, 0, 0, 0.1);
            color: white;
            padding: 2rem 0;
            margin-top: 3rem;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand fw-bold" href="/">
                <i class="fas fa-chart-line me-2"></i>Finansal Analiz
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Ana Sayfa</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/dashboard">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/analysis">Analiz</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/about">Hakkında</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Page Header -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-body text-center">
                        <h1 class="display-5 fw-bold text-primary">
                            <i class="fas fa-tachometer-alt me-3"></i>Finansal Dashboard
                        </h1>
                        <p class="lead">Borsa İstanbul hisse senetlerinin genel görünümü ve analizi</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stock Selection -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-cog me-2"></i>Dashboard Ayarları
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="stockSelect" class="form-label">Hisse Senedi:</label>
                                <select class="form-select" id="stockSelect">
                                    {% for kod, sembol in hisseler.items() %}
                                    <option value="{{ sembol }}">{{ kod }} - {{ sembol }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="periodSelect" class="form-label">Veri Aralığı:</label>
                                <select class="form-select" id="periodSelect">
                                    <option value="1mo">1 Ay</option>
                                    <option value="3mo" selected>3 Ay</option>
                                    <option value="6mo">6 Ay</option>
                                    <option value="1y">1 Yıl</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">&nbsp;</label>
                                <button class="btn btn-primary w-100" onclick="loadDashboard()">
                                    <i class="fas fa-sync-alt me-2"></i>Dashboard'ı Güncelle
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="stats-card">
                    <i class="fas fa-chart-line fa-2x mb-3"></i>
                    <div class="stats-number" id="currentPrice">--</div>
                    <div>Mevcut Fiyat</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <i class="fas fa-percentage fa-2x mb-3"></i>
                    <div class="stats-number" id="changePercent">--</div>
                    <div>Günlük Değişim</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <i class="fas fa-chart-area fa-2x mb-3"></i>
                    <div class="stats-number" id="rsiValue">--</div>
                    <div>RSI Değeri</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <i class="fas fa-arrow-trend-up fa-2x mb-3"></i>
                    <div class="stats-number" id="trendSignal">--</div>
                    <div>Trend Sinyali</div>
                </div>
            </div>
        </div>

        <!-- Charts Row 1 -->
        <div class="row mb-4">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-chart-line me-2"></i>Fiyat Grafiği ve Teknik Göstergeler
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="priceChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-chart-pie me-2"></i>RSI Analizi
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="rsiChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Row 2 -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0">
                            <i class="fas fa-chart-bar me-2"></i>Hacim Analizi
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="volumeChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-secondary text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-chart-line me-2"></i>Bollinger Bands
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="bollingerChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Technical Analysis Summary -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-analytics me-2"></i>Teknik Analiz Özeti
                        </h5>
                    </div>
                    <div class="card-body" id="technicalSummary">
                        <p class="text-muted">Dashboard'ı güncellemek için yukarıdaki butona tıklayın.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container text-center">
            <p>&copy; 2025 Finansal Veri Analiz Platformu. Geliştiren: Çağatay Elaman</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let priceChart = null;
        let rsiChart = null;
        let volumeChart = null;
        let bollingerChart = null;

        function loadDashboard() {
            const symbol = document.getElementById('stockSelect').value;
            const period = document.getElementById('periodSelect').value;
            
            // Loading göster
            document.getElementById('technicalSummary').innerHTML = '<div class="text-center"><i class="fas fa-spinner fa-spin fa-2x"></i><p>Dashboard yükleniyor...</p></div>';
            
            // Teknik analiz verisi yükle
            fetch(`/api/technical_analysis?symbol=${symbol}&period=${period}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        updateDashboard(data);
                    } else {
                        document.getElementById('technicalSummary').innerHTML = `<div class="alert alert-danger">Hata: ${data.error}</div>`;
                    }
                })
                .catch(error => {
                    document.getElementById('technicalSummary').innerHTML = `<div class="alert alert-danger">Hata: ${error}</div>`;
                });
        }

        function updateDashboard(data) {
            // İstatistikleri güncelle
            document.getElementById('currentPrice').textContent = data.current_price + ' TL';
            document.getElementById('changePercent').textContent = data.current_rsi.toFixed(2);
            document.getElementById('rsiValue').textContent = data.current_rsi.toFixed(2);
            
            // Trend sinyali
            let trendSignal = 'Nötr';
            if (data.current_price > data.current_ma20 && data.current_ma20 > data.current_ma50) {
                trendSignal = 'Yükseliş';
            } else if (data.current_price < data.current_ma20 && data.current_ma20 < data.current_ma50) {
                trendSignal = 'Düşüş';
            }
            document.getElementById('trendSignal').textContent = trendSignal;

            // Grafikleri güncelle
            updatePriceChart(data);
            updateRSIChart(data);
            updateVolumeChart(data);
            updateBollingerChart(data);
            
            // Teknik analiz özeti
            updateTechnicalSummary(data);
        }

        function updatePriceChart(data) {
            const ctx = document.getElementById('priceChart').getContext('2d');
            
            if (priceChart) {
                priceChart.destroy();
            }
            
            priceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.dates,
                    datasets: [{
                        label: 'Kapanış Fiyatı',
                        data: data.close,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.1
                    }, {
                        label: '20 Günlük MA',
                        data: data.ma20,
                        borderColor: '#ff6384',
                        backgroundColor: 'rgba(255, 99, 132, 0.1)',
                        tension: 0.1
                    }, {
                        label: '50 Günlük MA',
                        data: data.ma50,
                        borderColor: '#36a2eb',
                        backgroundColor: 'rgba(54, 162, 235, 0.1)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Fiyat ve Hareketli Ortalamalar'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false
                        }
                    }
                }
            });
        }

        function updateRSIChart(data) {
            const ctx = document.getElementById('rsiChart').getContext('2d');
            
            if (rsiChart) {
                rsiChart.destroy();
            }
            
            rsiChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.dates,
                    datasets: [{
                        label: 'RSI',
                        data: data.rsi,
                        borderColor: '#ff6384',
                        backgroundColor: 'rgba(255, 99, 132, 0.1)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'RSI (14)'
                        }
                    },
                    scales: {
                        y: {
                            min: 0,
                            max: 100
                        }
                    }
                }
            });
        }

        function updateVolumeChart(data) {
            const ctx = document.getElementById('volumeChart').getContext('2d');
            
            if (volumeChart) {
                volumeChart.destroy();
            }
            
            // Hacim verisi yoksa, fiyat verisini kullan
            const volumeData = data.volume || data.close;
            
            volumeChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.dates.slice(-20), // Son 20 gün
                    datasets: [{
                        label: 'Hacim',
                        data: volumeData.slice(-20),
                        backgroundColor: 'rgba(54, 162, 235, 0.6)',
                        borderColor: '#36a2eb',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Hacim Analizi (Son 20 Gün)'
                        }
                    }
                }
            });
        }

        function updateBollingerChart(data) {
            const ctx = document.getElementById('bollingerChart').getContext('2d');
            
            if (bollingerChart) {
                bollingerChart.destroy();
            }
            
            bollingerChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.dates,
                    datasets: [{
                        label: 'Kapanış Fiyatı',
                        data: data.close,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.1
                    }, {
                        label: 'Üst Band',
                        data: data.upper_band,
                        borderColor: '#ff6384',
                        backgroundColor: 'rgba(255, 99, 132, 0.1)',
                        tension: 0.1
                    }, {
                        label: 'Alt Band',
                        data: data.lower_band,
                        borderColor: '#36a2eb',
                        backgroundColor: 'rgba(54, 162, 235, 0.1)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Bollinger Bands'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false
                        }
                    }
                }
            });
        }

        function updateTechnicalSummary(data) {
            const currentPrice = data.current_price;
            const currentRsi = data.current_rsi;
            const currentMa20 = data.current_ma20;
            const currentMa50 = data.current_ma50;
            
            let rsiSignal = '';
            if (currentRsi > 70) {
                rsiSignal = '<span class="badge bg-danger">Aşırı Alım</span>';
            } else if (currentRsi < 30) {
                rsiSignal = '<span class="badge bg-success">Aşırı Satım</span>';
            } else {
                rsiSignal = '<span class="badge bg-warning">Nötr</span>';
            }
            
            let trendSignal = '';
            if (currentPrice > currentMa20 && currentMa20 > currentMa50) {
                trendSignal = '<span class="badge bg-success">Yükseliş Trendi</span>';
            } else if (currentPrice < currentMa20 && currentMa20 < currentMa50) {
                trendSignal = '<span class="badge bg-danger">Düşüş Trendi</span>';
            } else {
                trendSignal = '<span class="badge bg-warning">Yatay Trend</span>';
            }
            
            document.getElementById('technicalSummary').innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <h6>Fiyat Analizi</h6>
                        <p><strong>Mevcut Fiyat:</strong> ${currentPrice} TL</p>
                        <p><strong>20 Günlük MA:</strong> ${currentMa20.toFixed(2)} TL</p>
                        <p><strong>50 Günlük MA:</strong> ${currentMa50.toFixed(2)} TL</p>
                        <p><strong>Trend Sinyali:</strong> ${trendSignal}</p>
                    </div>
                    <div class="col-md-6">
                        <h6>Teknik Göstergeler</h6>
                        <p><strong>RSI (14):</strong> ${currentRsi.toFixed(2)} ${rsiSignal}</p>
                        <p><strong>Fiyat/MA20:</strong> ${(currentPrice / currentMa20 * 100 - 100).toFixed(2)}%</p>
                        <p><strong>Fiyat/MA50:</strong> ${(currentPrice / currentMa50 * 100 - 100).toFixed(2)}%</p>
                        <p><strong>MA20/MA50:</strong> ${(currentMa20 / currentMa50 * 100 - 100).toFixed(2)}%</p>
                    </div>
                </div>
            `;
        }

        // Sayfa yüklendiğinde dashboard'ı yükle
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboard();
        });
    </script>
</body>
</html>
